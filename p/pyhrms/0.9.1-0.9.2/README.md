# Comparing `tmp/pyhrms-0.9.1.zip` & `tmp/pyhrms-0.9.2.zip`

## zipinfo {}

```diff
@@ -1,16 +1,16 @@
-Zip file size: 105015 bytes, number of entries: 14
-drwxr-xr-x  2.0 unx        0 b- stor 24-May-09 18:17 pyhrms-0.9.1/
-drwxr-xr-x  2.0 unx        0 b- stor 24-May-09 18:17 pyhrms-0.9.1/pyhrms.egg-info/
-drwxr-xr-x  2.0 unx        0 b- stor 24-May-09 18:17 pyhrms-0.9.1/pyhrms/
--rw-r--r--  2.0 unx    30509 b- defN 24-May-09 18:17 pyhrms-0.9.1/PKG-INFO
--rwx------  2.0 unx      927 b- defN 24-May-09 18:07 pyhrms-0.9.1/setup.py
--rw-r--r--  2.0 unx       38 b- defN 24-May-09 18:17 pyhrms-0.9.1/setup.cfg
--rwx------  2.0 unx    25939 b- defN 24-May-09 18:15 pyhrms-0.9.1/README.rst
--rw-r--r--  2.0 unx    30509 b- defN 24-May-09 18:17 pyhrms-0.9.1/pyhrms.egg-info/PKG-INFO
--rw-r--r--  2.0 unx      204 b- defN 24-May-09 18:17 pyhrms-0.9.1/pyhrms.egg-info/SOURCES.txt
--rw-r--r--  2.0 unx      181 b- defN 24-May-09 18:17 pyhrms-0.9.1/pyhrms.egg-info/requires.txt
--rw-r--r--  2.0 unx        7 b- defN 24-May-09 18:17 pyhrms-0.9.1/pyhrms.egg-info/top_level.txt
--rw-r--r--  2.0 unx        1 b- defN 24-May-09 18:17 pyhrms-0.9.1/pyhrms.egg-info/dependency_links.txt
--rwx------  2.0 unx   317974 b- defN 24-May-09 18:06 pyhrms-0.9.1/pyhrms/pyhrms.py
--rwx------  2.0 unx     2225 b- defN 24-May-09 18:07 pyhrms-0.9.1/pyhrms/__init__.py
-14 files, 408514 bytes uncompressed, 103093 bytes compressed:  74.8%
+Zip file size: 105080 bytes, number of entries: 14
+drwxr-xr-x  2.0 unx        0 b- stor 24-May-25 21:40 pyhrms-0.9.2/
+drwxr-xr-x  2.0 unx        0 b- stor 24-May-25 21:40 pyhrms-0.9.2/pyhrms.egg-info/
+drwxr-xr-x  2.0 unx        0 b- stor 24-May-25 21:40 pyhrms-0.9.2/pyhrms/
+-rw-r--r--  2.0 unx    30291 b- defN 24-May-25 21:40 pyhrms-0.9.2/PKG-INFO
+-rwx------  2.0 unx      927 b- defN 24-May-25 21:39 pyhrms-0.9.2/setup.py
+-rw-r--r--  2.0 unx       38 b- defN 24-May-25 21:40 pyhrms-0.9.2/setup.cfg
+-rwx------  2.0 unx    25745 b- defN 24-May-25 21:39 pyhrms-0.9.2/README.rst
+-rw-r--r--  2.0 unx    30291 b- defN 24-May-25 21:40 pyhrms-0.9.2/pyhrms.egg-info/PKG-INFO
+-rw-r--r--  2.0 unx      204 b- defN 24-May-25 21:40 pyhrms-0.9.2/pyhrms.egg-info/SOURCES.txt
+-rw-r--r--  2.0 unx      181 b- defN 24-May-25 21:40 pyhrms-0.9.2/pyhrms.egg-info/requires.txt
+-rw-r--r--  2.0 unx        7 b- defN 24-May-25 21:40 pyhrms-0.9.2/pyhrms.egg-info/top_level.txt
+-rw-r--r--  2.0 unx        1 b- defN 24-May-25 21:40 pyhrms-0.9.2/pyhrms.egg-info/dependency_links.txt
+-rwx------  2.0 unx   319231 b- defN 24-May-25 21:37 pyhrms-0.9.2/pyhrms/pyhrms.py
+-rwx------  2.0 unx     2225 b- defN 24-May-25 21:37 pyhrms-0.9.2/pyhrms/__init__.py
+14 files, 409141 bytes uncompressed, 103158 bytes compressed:  74.8%
```

## zipnote {}

```diff
@@ -1,43 +1,43 @@
-Filename: pyhrms-0.9.1/
+Filename: pyhrms-0.9.2/
 Comment: 
 
-Filename: pyhrms-0.9.1/pyhrms.egg-info/
+Filename: pyhrms-0.9.2/pyhrms.egg-info/
 Comment: 
 
-Filename: pyhrms-0.9.1/pyhrms/
+Filename: pyhrms-0.9.2/pyhrms/
 Comment: 
 
-Filename: pyhrms-0.9.1/PKG-INFO
+Filename: pyhrms-0.9.2/PKG-INFO
 Comment: 
 
-Filename: pyhrms-0.9.1/setup.py
+Filename: pyhrms-0.9.2/setup.py
 Comment: 
 
-Filename: pyhrms-0.9.1/setup.cfg
+Filename: pyhrms-0.9.2/setup.cfg
 Comment: 
 
-Filename: pyhrms-0.9.1/README.rst
+Filename: pyhrms-0.9.2/README.rst
 Comment: 
 
-Filename: pyhrms-0.9.1/pyhrms.egg-info/PKG-INFO
+Filename: pyhrms-0.9.2/pyhrms.egg-info/PKG-INFO
 Comment: 
 
-Filename: pyhrms-0.9.1/pyhrms.egg-info/SOURCES.txt
+Filename: pyhrms-0.9.2/pyhrms.egg-info/SOURCES.txt
 Comment: 
 
-Filename: pyhrms-0.9.1/pyhrms.egg-info/requires.txt
+Filename: pyhrms-0.9.2/pyhrms.egg-info/requires.txt
 Comment: 
 
-Filename: pyhrms-0.9.1/pyhrms.egg-info/top_level.txt
+Filename: pyhrms-0.9.2/pyhrms.egg-info/top_level.txt
 Comment: 
 
-Filename: pyhrms-0.9.1/pyhrms.egg-info/dependency_links.txt
+Filename: pyhrms-0.9.2/pyhrms.egg-info/dependency_links.txt
 Comment: 
 
-Filename: pyhrms-0.9.1/pyhrms/pyhrms.py
+Filename: pyhrms-0.9.2/pyhrms/pyhrms.py
 Comment: 
 
-Filename: pyhrms-0.9.1/pyhrms/__init__.py
+Filename: pyhrms-0.9.2/pyhrms/__init__.py
 Comment: 
 
 Zip file comment:
```

## Comparing `pyhrms-0.9.1/PKG-INFO` & `pyhrms-0.9.2/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 1.2
 Name: pyhrms
-Version: 0.9.1
+Version: 0.9.2
 Summary: A powerful GC/LC-HRMS data analysis tool
 Home-page: https://github.com/WangRui5/PyHRMS.git
 Author: Wang Rui
 Author-email: wtrt7009@gmail.com
 License: UNKNOWN
 Description: PyHRMS: Tools For working with High Resolution Mass Spectrometry (HRMS) data in Environmental Science
         =====================================================================================================
@@ -15,23 +15,20 @@
         
         Contributer: Rui Wang
         ======================
         First release date: Nov.15.2021
         
         Update
         ======
-        May.9.2024: pyhrms update Log 0.9.1::
+        May.25.2024: pyhrms update Log 0.9.2::
         
-            * Updated 'summarize_result' function to now include Source information retrieval.
+            * Enhanced summarize_pos_neg_result to include new_index in both positive and negative results.
         
-            * Improved the performance of 'peak_checking_area' for faster processing.
+            * Improved formula_prediction by adding an all_info parameter.
         
-            * Updated 'one_step_process_ms2' along with its internal functions to enhance functionality.
-        
-            * Added a new function 'convert_df_to_mgf' to facilitate conversion of DataFrame to MGF files.
         
         pyhrms can be installed and import as following:
         
         .. code-block:: python
         
             pip install pyhrms
```

## Comparing `pyhrms-0.9.1/setup.py` & `pyhrms-0.9.2/setup.py`

 * *Files 1% similar despite different names*

```diff
@@ -2,15 +2,15 @@
 
 def readme_file():
     with open('README.rst') as rf:
         return rf.read()
 
 setuptools.setup(
     name = 'pyhrms',
-    version = '0.9.1',
+    version = '0.9.2',
     author = 'Wang Rui',
     author_email = 'wtrt7009@gmail.com',
     url = 'https://github.com/WangRui5/PyHRMS.git',
     description = 'A powerful GC/LC-HRMS data analysis tool',
     long_description = readme_file(),
     packages = setuptools.find_packages(),
     install_requires = ['numpy>=1.19.2','pandas>=1.3.3'
```

## Comparing `pyhrms-0.9.1/README.rst` & `pyhrms-0.9.2/README.rst`

 * *Files 0% similar despite different names*

```diff
@@ -7,23 +7,20 @@
 
 Contributer: Rui Wang
 ======================
 First release date: Nov.15.2021
 
 Update
 ======
-May.9.2024: pyhrms update Log 0.9.1::
+May.25.2024: pyhrms update Log 0.9.2::
 
-    * Updated 'summarize_result' function to now include Source information retrieval.
+    * Enhanced summarize_pos_neg_result to include new_index in both positive and negative results.
 
-    * Improved the performance of 'peak_checking_area' for faster processing.
+    * Improved formula_prediction by adding an all_info parameter.
 
-    * Updated 'one_step_process_ms2' along with its internal functions to enhance functionality.
-
-    * Added a new function 'convert_df_to_mgf' to facilitate conversion of DataFrame to MGF files.
 
 pyhrms can be installed and import as following:
 
 .. code-block:: python
 
     pip install pyhrms
```

## Comparing `pyhrms-0.9.1/pyhrms.egg-info/PKG-INFO` & `pyhrms-0.9.2/pyhrms.egg-info/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 1.2
 Name: pyhrms
-Version: 0.9.1
+Version: 0.9.2
 Summary: A powerful GC/LC-HRMS data analysis tool
 Home-page: https://github.com/WangRui5/PyHRMS.git
 Author: Wang Rui
 Author-email: wtrt7009@gmail.com
 License: UNKNOWN
 Description: PyHRMS: Tools For working with High Resolution Mass Spectrometry (HRMS) data in Environmental Science
         =====================================================================================================
@@ -15,23 +15,20 @@
         
         Contributer: Rui Wang
         ======================
         First release date: Nov.15.2021
         
         Update
         ======
-        May.9.2024: pyhrms update Log 0.9.1::
+        May.25.2024: pyhrms update Log 0.9.2::
         
-            * Updated 'summarize_result' function to now include Source information retrieval.
+            * Enhanced summarize_pos_neg_result to include new_index in both positive and negative results.
         
-            * Improved the performance of 'peak_checking_area' for faster processing.
+            * Improved formula_prediction by adding an all_info parameter.
         
-            * Updated 'one_step_process_ms2' along with its internal functions to enhance functionality.
-        
-            * Added a new function 'convert_df_to_mgf' to facilitate conversion of DataFrame to MGF files.
         
         pyhrms can be installed and import as following:
         
         .. code-block:: python
         
             pip install pyhrms
```

## Comparing `pyhrms-0.9.1/pyhrms/pyhrms.py` & `pyhrms-0.9.2/pyhrms/pyhrms.py`

 * *Files 2% similar despite different names*

```diff
@@ -2757,16 +2757,25 @@
         all_df_pos: all_df_pos
         all_df_neg: all_df_neg
     return: final result
     """
     df_pos_neg = pd.concat([all_df_pos, all_df_neg], axis=0)
     iks = df_pos_neg['ik'].value_counts().index
     df_all = []
-    for ik in iks:
-        df1 = df_pos_neg[df_pos_neg['ik'] == ik]
+    for ik in tqdm(iks, desc='Collecting Info'):
+        df1 = df_pos_neg[df_pos_neg['ik'] == ik].copy()
+
+        index_info = df1.loc[:, ['new_index', 'mode']]
+        index_pos = index_info[index_info['mode'].str.contains('pos')]['new_index']
+        index_neg = index_info[index_info['mode'].str.contains('neg')]['new_index']
+        index_pos1 = index_pos.values[0] if len(index_pos) != 0 else np.nan
+        index_neg1 = index_neg.values[0] if len(index_neg) != 0 else np.nan
+        df1['new_index_pos'] = index_pos1
+        df1['new_index_neg'] = index_neg1
+
         df1 = df1.sort_values(by='Confidence level')
         df2 = df1.iloc[0]
         df3 = df2.to_dict()
         # 更新点位的名称，和点位的个数
         site = list(set([j for i in df1['site'].values for j in eval(i)]))
         df3['site'] = str(site)
         df3['sites_num'] = len(site)
@@ -6004,30 +6013,35 @@
         final_df = pd.concat([istd_df, df_q], axis=1)
         final_data.append(final_df)
 
     return final_data
 
 
 def formula_prediction(mz, mode, atoms=['C', 'H', 'O', 'N'],
-                       atom_n=[[5, 30], [0, 50], [0, 30], [0, 10]], max_possible_num=2e7, mz_error=5):
+                       atom_n=[[5, 30], [0, 50], [0, 30], [0, 10]], max_possible_num=2e7, mz_error=5, all_info=False):
     """
-    Predicts the chemical formula based on the provided mz value.
+    Predicts the chemical formula based on the provided m/z value(s).
 
     Parameters:
-    - mz (float or list/np.ndarray): The mass-to-charge ratio(s). If a list/ndarray is provided, formulae for all values will be predicted.
-    - atoms (list): List of chemical elements to consider.
-    - atom_n (list): Range for each atom to consider in the prediction.
-    - max_possible_num (float): Maximum number of possible structures allowed.
-    - mz_error (float): Allowed error for the mz value.
+        mz (float or list/np.ndarray): The mass-to-charge ratio(s). If a list or ndarray is provided, 
+                                       formulae for all values will be predicted.
+        mode (str): The ionization mode ('pos' for positive or 'neg' for negative).
+        atoms (list): List of chemical elements to consider. Defaults to ['C', 'H', 'O', 'N'].
+        atom_n (list): Range for each atom to consider in the prediction. Defaults to [[5, 30], [0, 50], [0, 30], [0, 10]].
+        max_possible_num (float): Maximum number of possible structures allowed. Defaults to 2e7.
+        mz_error (float): Allowed error for the m/z value in parts per million (ppm). Defaults to 5.
+        all_info (bool): If True, returns all possible formulas and their errors. If False, returns only the best match. Defaults to False.
 
     Returns:
-    - DataFrame or tuple: For a single mz (float), returns a DataFrame of possible formulae. For multiple mz values (list/np.ndarray), returns a tuple of possible formulae and their corresponding errors.
+        DataFrame or tuple: For a single m/z (float), returns a DataFrame of possible formulae. 
+                            For multiple m/z values (list/np.ndarray), returns a tuple of possible formulae and their corresponding errors.
 
     Raises:
-    - ValueError: If the number of possible structures exceeds the max_possible_num.
+        ValueError: If the number of possible structures exceeds the max_possible_num.
+                    If the type of mz is unsupported.
     """
     atom_mass_table1 = pd.Series(
         data={'C': 12.000000, 'Ciso': 13.003355, 'N': 14.003074, 'Niso': 15.000109, 'O': 15.994915, 'H': 1.007825,
               'Oiso': 17.999159, 'F': 18.998403, 'K': 38.963708, 'P': 30.973763, 'Cl': 34.968853,
               'S': 31.972072, 'Siso': 33.967868, 'Br': 78.918336, 'Na': 22.989770, 'Si': 27.976928,
               'Fe': 55.934939, 'Se': 79.916521, 'As': 74.921596, 'I': 126.904477, 'D': 2.014102,
               'Co': 58.933198, 'Au': 196.966560, 'B': 11.009305, 'e': 0.0005486
@@ -6081,15 +6095,15 @@
             df1 = df.sort_values(by=hetero_atoms).reset_index(drop=True)
             df1['mz_error'] = round((df1['exact_mass'] - target_mz) / target_mz * 1e6, 2)
             df1['formula'] = df1.apply(generate_formula, axis=1)
             return df1
     elif isinstance(mz, (list, np.ndarray)):
         possible_formulas = []
         errors = []
-        for target_mz in tqdm(mz, desc='Calculating the formula'):
+        for target_mz in tqdm(mz, desc='Calculating the formula', leave=False):
             index = np.argwhere((mzs > target_mz * (1 - mz_error * 1e-6)) & (mzs < target_mz * (1 + mz_error * 1e-6)))
             if len(index) == 0:
                 possible_formulas.append(None)
                 errors.append(None)
             else:
                 arr1 = patterns[index]
                 exact_mass = mzs[index]
@@ -6098,16 +6112,20 @@
                 # Creating the DataFrame
                 df = pd.DataFrame(arr_2d, columns=atoms)
                 df['exact_mass'] = exact_mass
                 hetero_atoms = [atom for atom in atoms if atom not in ['C', 'H', 'O', 'N']]
                 df1 = df.sort_values(by=hetero_atoms).reset_index(drop=True)
                 df1['mz_error'] = round((df1['exact_mass'] - target_mz) / target_mz * 1e6, 2)
                 df1['formula'] = df1.apply(generate_formula, axis=1)
-                possible_formulas.append(df1.loc[0, 'formula'])
-                errors.append(df1.loc[0, 'mz_error'])
+                if all_info is False:
+                    possible_formulas.append(df1.loc[0, 'formula'])
+                    errors.append(df1.loc[0, 'mz_error'])
+                else:
+                    possible_formulas.append(str(list(df1['formula'].values)))
+                    errors.append(str(list(df1['mz_error'].values)))
         return possible_formulas, errors
     else:
         raise ValueError(f"Unsupported type for mz: {type(mz)}")
 
 
 def convert_db(df, relative_i_threshold=20, source='', source_info=''):
     """
```

## Comparing `pyhrms-0.9.1/pyhrms/__init__.py` & `pyhrms-0.9.2/pyhrms/__init__.py`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 from . import pyhrms
 
-__version__ = "0.9.1"
+__version__ = "0.9.2"
 
 __all__ = [
     "sep_scans",
     "gen_df",
     "peak_picking",
     "split_peak_picking",
     "remove_unnamed_columns",
```

